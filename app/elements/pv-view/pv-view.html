<link rel="import" href="../threejs/threejs.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../microtome-lib/microtome-lib.html">
<link rel="import" href="../fab-radial/fab-radial.html">

<link rel="import" href="../../styles/shared-styles.html">

<dom-module id="pv-view">
  <style include="shared-styles">
    :host {
      position: relative;
      background: linear-gradient(var(--gradient-light, --paper-grey-600), var(--gradient-dark, --paper-grey-900));
      box-shadow: inset 0 0 25px #000000;
    }

    :host #pv-canvas-home {
      scroll: none;
      background: none;
    }

    :host >::content canvas {
      width: 100%;
      height: 100%;
    }

    :host #pv-toolbar-overlay {
      position: absolute;
      width: 200px;
      top: 0px;
      right: 0px;
      bottom: 0px;
      pointer-events: none;
      /*color: #afafaf;*/
      margin: 25px;
      z-index: 10;
    }

    :host #pv-toolbar-overlay > * {
      pointer-events: auto;
    }

    :host #mesh-list {
      width: 100%;
    }

    :host #file-chooser {
      z-index: 20;
    }
  </style>
  <template>
    <fab-radial id="pv-fab-radial">
      <paper-fab mini class="menu-north" icon="add" id="add-model-button" title="Add Model" on-click="showFileChooser"></paper-fab>
      <paper-fab mini class="menu-north-east" id="delete-model-button" icon="delete" title="Remove Model"></paper-fab>
      <paper-fab mini class="menu-south-east" id="slice-preview-button" icon="maps:layers" title="Slice Preview" on-click="toggleSlicePreview"></paper-fab>
      <paper-fab mini class="menu-east" id="content-copy-button" icon="content-copy" title="Copy Model"></paper-fab>
      <paper-fab mini class="menu-south" id="save-project-button" icon="save" title="Save Scene"></paper-fab>
      <paper-fab mini class="menu-south-west" id="scale-model-button" icon="fa-directional:arrows-alt" title="Scale Model"></paper-fab>
      <paper-fab mini class="menu-west" id="rotate-model-button" icon="3d-rotation" title="Rotate Model"></paper-fab>
      <paper-fab mini class="menu-north-west" id="move-model-button" icon="fa-directional:arrows" title="Move Model"></paper-fab>
    </fab-radial>


    <div id="pv-toolbar-overlay" class="vertical layout start-justified end">
      <div>
        <span class="sub-head">Position</span>
        <br/>
        <div class="horizontal layout">
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="mX(mm)" value="{{pickedMesh.position.x}}" type="number"></paper-input>
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="mY(mm)" value="{{pickedMesh.position.y}}" type="number"></paper-input>
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="mZ(mm)" value="{{pickedMesh.position.z}}" type="number"></paper-input>
        </div>
      </div>
      <div>
        <span class="sub-head">Rotation</span>
        <br/>
        <div class="horizontal layout">
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="rX(deg)" value="{{_rotX}}" type="number"></paper-input>
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="rY(deg)" value="{{_rotY}}" type="number"></paper-input>
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="rZ(deg)" value="{{_rotZ}}" type="number"></paper-input>
        </div>
      </div>
      <div>
        <span class="sub-head">Scale</span>
        <br/>
        <div class="horizontal layout">
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="sX" value="{{_sX}}" type="number" step="0.05" min="0.00"></paper-input>
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="sY" value="{{_sY}}" type="number" step="0.05" min="0.00"></paper-input>
          <paper-input disabled="{{!pickedMesh}}" always-float-label label="sZ" value="{{_sZ}}" type="number" step="0.05" min="0.00"></paper-input>
        </div>
      </div>
      <div id="mesh-list" class="flex vertical layout">
        <span class="sub-head">Meshes</span>
        <iron-list class="flex" items="[[scene.printObjects]]" as="item">
          <template>
            <div>Id: [[item.id]]</div>
          </template>
        </iron-list>
      </div>
    </div>

    <div id="pv-canvas-home" class="fit" on-mousedown="preparePick" on-mousemove="cancelPick" on-mouseup="tryPick"  on-contextmenu="onPrintVolumeViewContextMenu">
    </div>

    <paper-dialog id="file-chooser" modal with-backdrop auto-fit-on-attach>
      <h2>Choose File</h2>
      <paper-input id="mesh-file" type="file" always-float-label label="Mesh File" value="{{_meshFile}}" accept=".obj,.stl"></paper-input>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus on-click="loadMesh">Load File</paper-button>
      </div>
    </paper-dialog>
  </template>
</dom-module>

<script src="pv-view.js"></script>
